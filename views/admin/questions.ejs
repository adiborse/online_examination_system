<%- include('../partials/header') %>

<div class="container admin-dashboard">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1>Manage Questions</h1>
        <button id="addQuestionBtn" class="btn btn-success">Add New Question</button>
    </div>
    
    <div class="card">
        <div class="card-header">
            Question Bank
        </div>
        <div class="card-body">
            <% if (questions.length > 0) { %>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Subject</th>
                                <th>Difficulty</th>
                                <th>Created By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% questions.forEach(question => { %>
                                <tr>
                                    <td style="max-width: 300px;">
                                        <%= question.question.length > 100 ? question.question.substring(0, 100) + '...' : question.question %>
                                    </td>
                                    <td><%= question.subject %></td>
                                    <td>
                                        <span class="badge" style="
                                            padding: 0.25rem 0.5rem;
                                            border-radius: 3px;
                                            font-size: 0.75rem;
                                            color: white;
                                            background-color: <%= question.difficulty === 'easy' ? '#28a745' : question.difficulty === 'medium' ? '#ffc107' : '#dc3545' %>;
                                        ">
                                            <%= question.difficulty.charAt(0).toUpperCase() + question.difficulty.slice(1) %>
                                        </span>
                                    </td>
                                    <td><%= question.createdBy.name %></td>
                                    <td>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <button class="btn btn-warning btn-sm edit-question" data-id="<%= question._id %>">
                                                Edit
                                            </button>
                                            <button class="btn btn-danger btn-sm delete-question" data-id="<%= question._id %>">
                                                Delete
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <% if (totalPages > 1) { %>
                    <div class="pagination">
                        <% if (hasPrev) { %>
                            <a href="/admin/questions?page=<%= currentPage - 1 %>">&laquo; Previous</a>
                        <% } %>
                        
                        <% for (let i = 1; i <= totalPages; i++) { %>
                            <% if (i === currentPage) { %>
                                <span class="current"><%= i %></span>
                            <% } else { %>
                                <a href="/admin/questions?page=<%= i %>"><%= i %></a>
                            <% } %>
                        <% } %>
                        
                        <% if (hasNext) { %>
                            <a href="/admin/questions?page=<%= currentPage + 1 %>">Next &raquo;</a>
                        <% } %>
                    </div>
                <% } %>
            <% } else { %>
                <div class="text-center" style="padding: 3rem;">
                    <h3>No Questions Found</h3>
                    <p style="color: #666;">Start by adding your first question to the question bank.</p>
                    <button id="addQuestionBtn" class="btn btn-primary">Add First Question</button>
                </div>
            <% } %>
        </div>
    </div>
</div>

<!-- Question Modal -->
<div id="questionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Add New Question</h3>
            <span class="close">&times;</span>
        </div>
        <form id="questionForm">
            <div class="form-group">
                <label for="question" class="form-label">Question Text *</label>
                <textarea id="question" name="question" class="form-control" rows="3" required></textarea>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="option1" class="form-label">Option 1 *</label>
                    <input type="text" id="option1" name="option1" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="option2" class="form-label">Option 2 *</label>
                    <input type="text" id="option2" name="option2" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="option3" class="form-label">Option 3 *</label>
                    <input type="text" id="option3" name="option3" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="option4" class="form-label">Option 4 *</label>
                    <input type="text" id="option4" name="option4" class="form-control" required>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <div class="form-group">
                    <label for="correctAnswer" class="form-label">Correct Answer (0-3) *</label>
                    <select id="correctAnswer" name="correctAnswer" class="form-control" required>
                        <option value="">Select correct option</option>
                        <option value="0">Option 1</option>
                        <option value="1">Option 2</option>
                        <option value="2">Option 3</option>
                        <option value="3">Option 4</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="difficulty" class="form-label">Difficulty</label>
                    <select id="difficulty" name="difficulty" class="form-control">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="subject" class="form-label">Subject *</label>
                    <input type="text" id="subject" name="subject" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="category" class="form-label">Category</label>
                    <input type="text" id="category" name="category" class="form-control">
                </div>
            </div>
            
            <div class="d-flex gap-1 justify-content-between mt-2">
                <button type="button" id="cancelBtn" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Question</button>
            </div>
        </form>
    </div>
</div>

<%- include('../partials/footer') %>
